---
created: 2024-03-01T18:15
updated: 2024-03-06T23:28
tags:
  - dairy
---
NPC AI 待解决功能：
- [x] SmartObjectHandle 置于 false 后，FindSmartObject 依然可以查找到 Handle
- [x] NPC 的 AI 用 PawnData 配置很繁琐，修改成挂组件的方式
	- [x] 支持自动初始化 Behavior Tree
	- [x] 自定义 AI 可用 Action Point，并可视化
- [ ] NPC 与玩家的交互
	- [ ] NPC 被玩家撞击出反应动作
	- [ ] 支持 NPC 感知（看到）到玩家时终止当前行为，执行动作（打招呼）
	- [ ] 玩家能主动和 NPC 对话，中断 NPC 当前行为。当对话结束后恢复 NPC 动作
- [ ] 移动过程中可动态避开障碍 (ROV)

- [ ] Action Point 能够让其他 Action Point 中执行动作的 AI 中断工作并向当前 Action Point 打招呼
- [ ] 允许 AI 聚集、逃离
- [ ] AI 移动时平滑经过移动点，不要停顿
	- [x] 取消 NPC 到达 Slot 后强制将 Pawn 朝向旋转到 Slot 的方向
	- [ ] 沿点移动必须用一个 Task 完成
		- [x] 何时进入路径移动状态
		- [ ] 预先确认路径点 AP 是否有行为需要执行，预先计算好路径
			- [ ] 重构 Smart Object Definition，Action 的配置方式朝 DAS 靠齐
		- [x] 如何进行路径移动
		- [x] AI 移动过程中，AP 的 Enable 状态如何修改 (不修改了，因为提前计算好路径，AI 进行移动，不执行 Action Point 逻辑)
- [ ] AI 移动时支持 Locomotion，让 AI 走路时动画多种多样
	- [ ] 参考解决方案：Retarget、蓝图控制不同 Locomotion 参数、场景中放置各种各样的工具来调整 Locomotion 
- [ ] AI 沿曲线移动
	- [ ] 检查 UCharacterMovementComponent::TickComponent，ConsumeInputVector() 函数每帧拿到的加速度方向是多少
	- [ ] `UCharacterMovementComponent::PhysicsRotation(float DeltaTime)` 调用了 `GetDeltaRotation(DeltaTime)`获取旋转速率，以用于在新旧 Rotation 之间进行插值计算当帧 AI 的 Rotation，然后调用 `MoveUpdateComponentImpl` 进行更新。
	- [ ] 从上面分析能够看出，UE 中的 AI 在转向的时候，AI 的 Rotation 是和当前朝向与加速度朝向之间插值得到的，那么下一步需要检查 AI 的移动方向是否也随着加速度方向一起插值呢？(从目测上并不是的)


